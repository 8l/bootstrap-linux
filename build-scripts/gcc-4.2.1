url=http://ftp.gnu.org/gnu/gcc/gcc-$version/gcc-core-$version.tar.bz2
patches=gcc-4.2.1-musl.diff

config() {
	sed -i 's@\./fixinc\.sh@-c true@' gcc/Makefile.in

	for i in strsignal putenv random setenv strstr strtod strtol strtoul; do
		culprit=libiberty/$i.c
		rm $culprit
		touch $culprit
	done

	mkdir "$work/gcc-build"
	cd "$work/gcc-build"
	"$work/$unpack"/configure --build=$A-unknown-linux-gnu --host=$A-unknown-linux-musl \
		--target=$A-unknown-linux-musl --enable-languages=c \
		--prefix=/ --disable-libmudflap --disable-shared \
		--disable-nls --disable-bootstrap --disable-libgomp \
		--disable-tls --with-newlib
}

build() {
	make all-gcc
}

install() {
	make install-gcc DESTDIR="$out"
	cd "$work/$unpack"
	rm -rf "$work/gcc-build"
}
